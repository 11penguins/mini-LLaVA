# 😻mini-LLaVA: An multimodal AI assistant🤖 for creating cute🥰 and literary🧐 style content based on LoRA

The backbone of mini-LLaVA adopts **Qwen2-0.5B** as the language model and **SigLIP** as the visual feature extractor for cross-modal connection. We adopted the **LoRA (rank = 8)** to simulate full fine tuning and combined with **8-bit quantization** deployment. In the blind test, the style consistency received **79% user preference**.

# 1. Main Environments
The following are the **external libraries** used in the project, as well as the versions adopted by the author during runtime.
```
1.  torch - 2.6.0
2.  transformers - 4.49.0
3.  PIL(Pillow) - 11.1.0
4.  requests - 2.22.0
5.  openai - 1.65.2
6.  tqdm - 4.67.1
```

# 2. File Structure
```
mnt/workspace/
│
├── train.py
├── utils.py
├── chat.py
├── LoRA/
│   ├── lora_config.py
│   └── lora_layer.py
├── data/
│   ├── cute.json
│   ├── literary.json
│   ├── dataset.py
│   ├── read_data.py
│   └── make_data.py
│
├── llava-interleave-qwen-0.5b-hf/...
│
└── lora_llava_finetuned/
    ├── cute.bin
    └── literary.bin
```
1. The `LoRA` folder contains the custom-made LoRA component and the parameter configuration file.  
2. The `data` folder contains triplet training data in cute and literary styles generated by DeepSeek-V3, as well as some data preprocessing files.  
3. The `lora_llava_finetuned` folder contains the fine-tuned weights for the two styles.  
4. The `llava-interleave-qwen-0.5b-hf` folder contains the pre-trained LLaVA-Qwen-0.5B model migrated from Modelscope to the local environment.

# 3. Download from Modelscope
If you want to learn more about **LLaVA-Qwen-0.5B**, please [click here to visit Modelscope.](https://www.modelscope.cn/models/llava-hf/llava-interleave-qwen-0.5b-hf)
You can execute the following command in the terminal to load the pre-trained model to your local machine.
```
# Install git-lfs to facilitate the download of large files.
apt install git-lfs
git lfs install

# Download weights
git clone https://www.modelscope.cn/llava-hf/llava-interleave-qwen-0.5b-hf.git

# If you want to use a more powerful 7B model instead of the 0.5B one, you can download the following pre-trained weights.
git clone https://www.modelscope.cn/llava-hf/llava-1.5-7b-hf.git
```
# 4. Chat with AI assistant🤖
1. Load the image you want to generate text for to your local machine. For this example, we will use this image about [food](https://th.bing.com/th/id/R.b3a7697d2793ba094a861d546c31190d?rik=NevOIW4XmkUuMA&riu=http%3a%2f%2fseopic.699pic.com%2fphoto%2f50069%2f5445.jpg_wh1200.jpg&ehk=wuLPicg%2b9wXz8QAwp%2fAVFBtJQ6loBUiVfQZu2bbZODA%3d&risl=&pid=ImgRaw&r=0) for testing. ![food](https://th.bing.com/th/id/R.b3a7697d2793ba094a861d546c31190d?rik=NevOIW4XmkUuMA&riu=http%3a%2f%2fseopic.699pic.com%2fphoto%2f50069%2f5445.jpg_wh1200.jpg&ehk=wuLPicg%2b9wXz8QAwp%2fAVFBtJQ6loBUiVfQZu2bbZODA%3d&risl=&pid=ImgRaw&r=0)
2. In the `chat.py` file, modify the `image_path` variable to the name of this image. 
3. Run `chat.py` and input "**lora**". Then, choose the style you want (**base**, **cute**, or **literary**). 
4. Ask the model a question (currently, it only supports **Chinese**), for example: "**这张图片是一些美食，帮我生成一段朋友圈的文案**" 
5. You will receive the result:
```bash
🤗：lora
请输入要替换的风格：cute
🤗：这张图片是一些美食，帮我生成一段朋友圈的文案
🤖：哎呀呀～今天给大家分享一个超级好吃的美食体验哦！😍 你看那串串的烤肉，外皮金黄酥脆，里面肉质鲜嫩多汁，简直是人间美味呢！😍 而且哦，每一口都能感受到烤肉的香香甜甜，简直是让人忍不住想再来一次呢！😍 还有那串串的蔬菜，绿绿的，看着就让人想吃，而且每一口都能感受到蔬菜的新鲜和美味，简直是让人停不下来！😍 这些美食的搭配，简直是让人停不下来，让人忍不住想要再来一次呢！😍 快来和我一起，享受这份美味吧！😘
🤗：lora
请输入要替换的风格：literary
🤗：这张图片是一些美食，帮我生成一段朋友圈的文案
🤖：在这张图片中，每一片肉都像是时间的碎片，轻轻抚摸着味蕾。那红色的肉，仿佛是岁月的印记，带着一股股温暖的光芒，让人不禁想要一口咬下。绿色的蔬菜，像是大自然的馈赠，为这顿晚餐增添了一抹生机。而那片绿色的蔬菜，像是时间的见证者，静静地躺在那里，等待着被我们用它来讲述一个故事。这顿晚餐，不仅仅是口中的享受，更是味蕾与心灵的对话。让我们一起，用这顿晚餐，去感受生活的美好，去体验美食的无限可能。#美食 #生活 #味蕾与心灵的对话
```
6. If you want to change the image mid-conversation, you can input “**image**”, then enter the name of the image you want to inquire about from your local machine.
```bash
🤗：lora
请输入要替换的风格：cute
🤗：image
请输入图片文件名：SU7_Ultra.png
图片'SU7_Ultra.png'加载成功
🤗：这张图片是小米汽车的发布海报，帮我生成一段小红书的文案
🤖：哎呀呀～今天要给大家种草一个超级酷炫的汽车哦！🚗💨 小米汽车的SUV系列，真的是让人忍不住想要开上一圈呢！黑色的车身加上红色的条纹装饰，简直就像是从童话世界里走出来的汽车一样！🚗💨 这辆SUV不仅外观酷炫，而且动力强劲，无论是日常通勤还是出街，都能让你感受到满满的自信！🚗💨 而且哦，它的价格也非常亲民，只要10000元，就能拥有这样一辆超级酷炫的汽车，是不是超级吸引人呢？😍 快来试试看吧，保证让你爱不释手！😘
```
# 5. Train your own featured AI assistant🤖
If you want to train an AI assistant in a style you like or not a copywriting type, you can do it yourself by following the steps below!
1. In the `data/make_data.py` file, modify the `prompt_template` and use your own `api_key`. If you have a large number of data entries, don't forget to modify `tot_num` to the number of triplet training data you want to generate. 
2. `make_data.py` will generate a JSON file at the end, which will be used as a dataset for `train.py`. In `train.py`, you can manually adjust the batch size, learning rate, and epoch for each training session. The resulting model weights will be saved in the `lora_llava_finetuned` folder. Don't forget to modify the weights file in `chat.py`!
